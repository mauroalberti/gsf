<!--?xml version="1.0" encoding="UTF-8"?-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Data/Cross.hs</title>
<link type="text/css" rel="stylesheet" href="src_Data_Cross.hs_files/hscolour.css">
</head>
<body>
<pre><a name="line-1"></a><span class="hs-comment">{-# LANGUAGE FlexibleInstances, FlexibleContexts, TypeOperators
<a name="line-2"></a>           , TypeFamilies, TypeSynonymInstances  #-}</span>
<a name="line-3"></a><span class="hs-comment">{-# OPTIONS_GHC -Wall #-}</span>
<a name="line-4"></a><span class="hs-comment">----------------------------------------------------------------------</span>
<a name="line-5"></a><span class="hs-comment">-- |</span>
<a name="line-6"></a><span class="hs-comment">-- Module      :  Data.Cross</span>
<a name="line-7"></a><span class="hs-comment">-- Copyright   :  (c) Conal Elliott 2008</span>
<a name="line-8"></a><span class="hs-comment">-- License     :  BSD3</span>
<a name="line-9"></a><span class="hs-comment">-- </span>
<a name="line-10"></a><span class="hs-comment">-- Maintainer  :  conal@conal.net</span>
<a name="line-11"></a><span class="hs-comment">-- Stability   :  experimental</span>
<a name="line-12"></a><span class="hs-comment">-- </span>
<a name="line-13"></a><span class="hs-comment">-- Cross products and normals</span>
<a name="line-14"></a><span class="hs-comment">----------------------------------------------------------------------</span>
<a name="line-15"></a>
<a name="line-16"></a><span class="hs-keyword">module</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Cross</span>
<a name="line-17"></a>  <span class="hs-layout">(</span>
<a name="line-18"></a>    <span class="hs-conid">HasNormal</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-varid">normal</span>
<a name="line-19"></a>  <span class="hs-layout">,</span> <span class="hs-conid">One</span><span class="hs-layout">,</span> <span class="hs-conid">Two</span><span class="hs-layout">,</span> <span class="hs-conid">Three</span>
<a name="line-20"></a>  <span class="hs-layout">,</span> <span class="hs-conid">HasCross2</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-conid">HasCross3</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span>
<a name="line-21"></a>  <span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-22"></a>
<a name="line-23"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">VectorSpace</span>
<a name="line-24"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">MemoTrie</span>
<a name="line-25"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Basis</span>
<a name="line-26"></a>
<a name="line-27"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Derivative</span>
<a name="line-28"></a>
<a name="line-29"></a><span class="hs-comment">-- | Thing with a normal vector (not necessarily normalized).</span>
<a name="line-30"></a><span class="hs-keyword">class</span> <span class="hs-conid">HasNormal</span> <span class="hs-varid">v</span> <span class="hs-keyword">where</span> <span class="hs-varid">normalVec</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">v</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">v</span>
<a name="line-31"></a>
<a name="line-32"></a><a name="normal"></a><span class="hs-comment">-- | Normalized normal vector.  See also 'cross'.</span>
<a name="line-33"></a><span class="hs-definition">normal</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-conid">HasNormal</span> <span class="hs-varid">v</span><span class="hs-layout">,</span> <span class="hs-conid">InnerSpace</span> <span class="hs-varid">v</span><span class="hs-layout">,</span> <span class="hs-conid">Floating</span> <span class="hs-layout">(</span><span class="hs-conid">Scalar</span> <span class="hs-varid">v</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-varid">v</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">v</span>
<a name="line-34"></a><span class="hs-definition">normal</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">normalized</span> <span class="hs-varop">.</span> <span class="hs-varid">normalVec</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="One"></a><span class="hs-comment">-- | Singleton</span>
<a name="line-37"></a><a name="One"></a><span class="hs-keyword">type</span> <span class="hs-conid">One</span>   <span class="hs-varid">s</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">s</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="Two"></a><span class="hs-comment">-- | Homogeneous pair</span>
<a name="line-40"></a><a name="Two"></a><span class="hs-keyword">type</span> <span class="hs-conid">Two</span>   <span class="hs-varid">s</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">s</span><span class="hs-layout">,</span><span class="hs-varid">s</span><span class="hs-layout">)</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="Three"></a><span class="hs-comment">-- | Homogeneous triple</span>
<a name="line-43"></a><a name="Three"></a><span class="hs-keyword">type</span> <span class="hs-conid">Three</span> <span class="hs-varid">s</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">s</span><span class="hs-layout">,</span><span class="hs-varid">s</span><span class="hs-layout">,</span><span class="hs-varid">s</span><span class="hs-layout">)</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="HasCross2"></a><span class="hs-comment">-- | Cross product of various forms of 2D vectors</span>
<a name="line-46"></a><a name="HasCross2"></a><span class="hs-keyword">class</span> <span class="hs-conid">HasCross2</span> <span class="hs-varid">v</span> <span class="hs-keyword">where</span> <span class="hs-varid">cross2</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">v</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">v</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="instance HasCross2 (u,u)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">AdditiveGroup</span> <span class="hs-varid">u</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">HasCross2</span> <span class="hs-layout">(</span><span class="hs-varid">u</span><span class="hs-layout">,</span><span class="hs-varid">u</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-49"></a>  <span class="hs-varid">cross2</span> <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-layout">,</span><span class="hs-varid">y</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">negateV</span> <span class="hs-varid">y</span><span class="hs-layout">,</span><span class="hs-varid">x</span><span class="hs-layout">)</span>  <span class="hs-comment">-- or @(y,-x)@?</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="instance HasCross2 (a:&gt;v)"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">HasTrie</span> <span class="hs-layout">(</span><span class="hs-conid">Basis</span> <span class="hs-varid">a</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-conid">HasCross2</span> <span class="hs-varid">v</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">HasCross2</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-conop">:&gt;</span><span class="hs-varid">v</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-52"></a>  <span class="hs-comment">-- 2d cross-product is linear</span>
<a name="line-53"></a>  <span class="hs-varid">cross2</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">fmapD</span> <span class="hs-varid">cross2</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="instance HasNormal (One s :&gt; Two s)"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">HasBasis</span> <span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-conid">HasTrie</span> <span class="hs-layout">(</span><span class="hs-conid">Basis</span> <span class="hs-varid">s</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-conid">Basis</span> <span class="hs-varid">s</span> <span class="hs-keyglyph">~</span> <span class="hs-conid">()</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span>
<a name="line-56"></a>         <span class="hs-conid">HasNormal</span> <span class="hs-layout">(</span><span class="hs-conid">One</span> <span class="hs-varid">s</span> <span class="hs-conop">:&gt;</span> <span class="hs-conid">Two</span> <span class="hs-varid">s</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-57"></a>  <span class="hs-varid">normalVec</span> <span class="hs-varid">v</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">cross2</span> <span class="hs-layout">(</span><span class="hs-varid">v</span> <span class="hs-varop">`derivAtBasis`</span> <span class="hs-conid">()</span><span class="hs-layout">)</span>
<a name="line-58"></a>
<a name="line-59"></a><span class="hs-comment">-- When I use atBasis (from LinearMap) instead of the more liberally-typed</span>
<a name="line-60"></a><span class="hs-comment">-- atB (below), I get a type error:</span>
<a name="line-61"></a><span class="hs-comment">-- </span>
<a name="line-62"></a><span class="hs-comment">--     Couldn't match expected type `Basis a1' against inferred type `()'</span>
<a name="line-63"></a><span class="hs-comment">--       Expected type: a1 :-* (s :&gt; Two s)</span>
<a name="line-64"></a><span class="hs-comment">--       Inferred type: s  :-* (s :&gt; Two s)</span>
<a name="line-65"></a><span class="hs-comment">--     In the first argument of `atB', namely `derivative v'</span>
<a name="line-66"></a><span class="hs-comment">-- </span>
<a name="line-67"></a><span class="hs-comment">-- I think this type error is a GHC bug, but I'm not sure.</span>
<a name="line-68"></a>
<a name="line-69"></a><span class="hs-comment">-- atB :: (AdditiveGroup b, HasTrie a) =&gt; Maybe (a :-&gt;: b) -&gt; a -&gt; b</span>
<a name="line-70"></a><span class="hs-comment">-- -- atB :: (AdditiveGroup b, HasBasis a, HasTrie (Basis a)) =&gt;</span>
<a name="line-71"></a><span class="hs-comment">-- --        Maybe (Basis a :-&gt;: b) -&gt; Basis a -&gt; b</span>
<a name="line-72"></a><span class="hs-comment">-- l `atB` b = maybe zeroV (`untrie` b) l</span>
<a name="line-73"></a>
<a name="line-74"></a>
<a name="line-75"></a><a name="instance HasNormal (Two (One s :&gt; s))"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">VectorSpace</span> <span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-conid">HasBasis</span> <span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-conid">HasTrie</span> <span class="hs-layout">(</span><span class="hs-conid">Basis</span> <span class="hs-varid">s</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-conid">Basis</span> <span class="hs-varid">s</span> <span class="hs-keyglyph">~</span> <span class="hs-conid">()</span><span class="hs-layout">)</span>
<a name="line-76"></a>    <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">HasNormal</span> <span class="hs-layout">(</span><span class="hs-conid">Two</span> <span class="hs-layout">(</span><span class="hs-conid">One</span> <span class="hs-varid">s</span> <span class="hs-conop">:&gt;</span> <span class="hs-varid">s</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-77"></a>  <span class="hs-varid">normalVec</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">unpairD</span> <span class="hs-varop">.</span> <span class="hs-varid">normalVec</span> <span class="hs-varop">.</span> <span class="hs-varid">pairD</span>
<a name="line-78"></a>
<a name="line-79"></a><span class="hs-comment">-- I don't know why I can't eliminate the @HasTrie (Basis s)@ constraints</span>
<a name="line-80"></a><span class="hs-comment">-- above, considering @Basis s ~ ()@ and @HasTrie ()@.</span>
<a name="line-81"></a>
<a name="line-82"></a><a name="HasCross3"></a><span class="hs-comment">-- | Cross product of various forms of 3D vectors</span>
<a name="line-83"></a><a name="HasCross3"></a><span class="hs-keyword">class</span> <span class="hs-conid">HasCross3</span> <span class="hs-varid">v</span> <span class="hs-keyword">where</span> <span class="hs-varid">cross3</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">v</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">v</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">v</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="instance HasCross3 (s,s,s)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Num</span> <span class="hs-varid">s</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">HasCross3</span> <span class="hs-layout">(</span><span class="hs-varid">s</span><span class="hs-layout">,</span><span class="hs-varid">s</span><span class="hs-layout">,</span><span class="hs-varid">s</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-86"></a>  <span class="hs-layout">(</span><span class="hs-varid">ax</span><span class="hs-layout">,</span><span class="hs-varid">ay</span><span class="hs-layout">,</span><span class="hs-varid">az</span><span class="hs-layout">)</span> <span class="hs-varop">`cross3`</span> <span class="hs-layout">(</span><span class="hs-varid">bx</span><span class="hs-layout">,</span><span class="hs-varid">by</span><span class="hs-layout">,</span><span class="hs-varid">bz</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span> <span class="hs-varid">ay</span> <span class="hs-varop">*</span> <span class="hs-varid">bz</span> <span class="hs-comment">-</span> <span class="hs-varid">az</span> <span class="hs-varop">*</span> <span class="hs-varid">by</span>
<a name="line-87"></a>                                   <span class="hs-layout">,</span> <span class="hs-varid">az</span> <span class="hs-varop">*</span> <span class="hs-varid">bx</span> <span class="hs-comment">-</span> <span class="hs-varid">ax</span> <span class="hs-varop">*</span> <span class="hs-varid">bz</span>
<a name="line-88"></a>                                   <span class="hs-layout">,</span> <span class="hs-varid">ax</span> <span class="hs-varop">*</span> <span class="hs-varid">by</span> <span class="hs-comment">-</span> <span class="hs-varid">ay</span> <span class="hs-varop">*</span> <span class="hs-varid">bx</span> <span class="hs-layout">)</span>
<a name="line-89"></a>
<a name="line-90"></a><span class="hs-comment">-- TODO: Eliminate the 'Num' constraint by using 'VectorSpace' operations.</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="instance HasCross3 (a:&gt;v)"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">HasBasis</span> <span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">HasTrie</span> <span class="hs-layout">(</span><span class="hs-conid">Basis</span> <span class="hs-varid">a</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-conid">VectorSpace</span> <span class="hs-varid">v</span><span class="hs-layout">,</span> <span class="hs-conid">HasCross3</span> <span class="hs-varid">v</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">HasCross3</span> <span class="hs-layout">(</span><span class="hs-varid">a</span><span class="hs-conop">:&gt;</span><span class="hs-varid">v</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-93"></a>  <span class="hs-comment">-- 3D cross-product is bilinear (curried linear)</span>
<a name="line-94"></a>  <span class="hs-varid">cross3</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">distrib</span> <span class="hs-varid">cross3</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="instance HasNormal (Two s :&gt; Three s)"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">Num</span> <span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-conid">HasTrie</span> <span class="hs-layout">(</span><span class="hs-conid">Basis</span> <span class="hs-layout">(</span><span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-varid">s</span><span class="hs-layout">)</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-conid">HasBasis</span> <span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-conid">Basis</span> <span class="hs-varid">s</span> <span class="hs-keyglyph">~</span> <span class="hs-conid">()</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span>
<a name="line-97"></a>         <span class="hs-conid">HasNormal</span> <span class="hs-layout">(</span><span class="hs-conid">Two</span> <span class="hs-varid">s</span> <span class="hs-conop">:&gt;</span> <span class="hs-conid">Three</span> <span class="hs-varid">s</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-98"></a>  <span class="hs-varid">normalVec</span> <span class="hs-varid">v</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">d</span> <span class="hs-layout">(</span><span class="hs-conid">Left</span> <span class="hs-conid">()</span><span class="hs-layout">)</span> <span class="hs-varop">`cross3`</span> <span class="hs-varid">d</span> <span class="hs-layout">(</span><span class="hs-conid">Right</span> <span class="hs-conid">()</span><span class="hs-layout">)</span>
<a name="line-99"></a>   <span class="hs-keyword">where</span>
<a name="line-100"></a>     <span class="hs-varid">d</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">derivAtBasis</span> <span class="hs-varid">v</span>
<a name="line-101"></a>
<a name="line-102"></a><a name="instance HasNormal (Three (Two s :&gt; s))"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span> <span class="hs-conid">VectorSpace</span> <span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-conid">HasBasis</span> <span class="hs-varid">s</span><span class="hs-layout">,</span> <span class="hs-conid">HasTrie</span> <span class="hs-layout">(</span><span class="hs-conid">Basis</span> <span class="hs-varid">s</span><span class="hs-layout">)</span>
<a name="line-103"></a>         <span class="hs-layout">,</span> <span class="hs-conid">HasNormal</span> <span class="hs-layout">(</span><span class="hs-conid">Two</span> <span class="hs-varid">s</span> <span class="hs-conop">:&gt;</span> <span class="hs-conid">Three</span> <span class="hs-varid">s</span><span class="hs-layout">)</span> <span class="hs-layout">)</span>
<a name="line-104"></a>         <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">HasNormal</span> <span class="hs-layout">(</span><span class="hs-conid">Three</span> <span class="hs-layout">(</span><span class="hs-conid">Two</span> <span class="hs-varid">s</span> <span class="hs-conop">:&gt;</span> <span class="hs-varid">s</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-105"></a>  <span class="hs-varid">normalVec</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">untripleD</span> <span class="hs-varop">.</span> <span class="hs-varid">normalVec</span> <span class="hs-varop">.</span> <span class="hs-varid">tripleD</span>
</pre>

</body></html>